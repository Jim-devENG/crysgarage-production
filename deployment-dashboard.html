<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crys Garage - Deployment Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a1a 50%,
          #0a0a0a 100%
        );
        color: #ffffff;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .status-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .status-card h3 {
        margin-bottom: 15px;
        color: #4ecdc4;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 10px;
      }

      .status-online {
        background: #4ecdc4;
      }
      .status-offline {
        background: #ff6b6b;
      }
      .status-warning {
        background: #feca57;
      }

      .action-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 40px;
      }

      .btn {
        padding: 15px 25px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn-primary {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
      }

      .btn-danger {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        color: white;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .logs {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        font-family: "JetBrains Mono", monospace;
        font-size: 14px;
        max-height: 400px;
        overflow-y: auto;
        white-space: pre-wrap;
      }

      .refresh-btn {
        background: none;
        border: 2px solid #4ecdc4;
        color: #4ecdc4;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 20px;
        transition: all 0.3s ease;
      }

      .refresh-btn:hover {
        background: #4ecdc4;
        color: white;
      }

      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      @media (max-width: 768px) {
        .status-grid {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ›ï¸ Crys Garage Deployment Dashboard</h1>
        <p>Monitor and manage your application deployment</p>
      </div>

      <div class="status-grid">
        <div class="status-card">
          <h3>ğŸŒ Application Status</h3>
          <div id="app-status">
            <span class="status-indicator status-online"></span>
            <span>Checking...</span>
          </div>
          <p style="margin-top: 10px; font-size: 14px">
            https://crysgarage.studio
          </p>
        </div>

        <div class="status-card">
          <h3>ğŸ³ Docker Containers</h3>
          <div id="container-status">
            <span class="status-indicator status-online"></span>
            <span>Checking...</span>
          </div>
          <p style="margin-top: 10px; font-size: 14px">
            Frontend, Backend, Ruby, Nginx
          </p>
        </div>

        <div class="status-card">
          <h3>ğŸ“Š Last Deployment</h3>
          <div id="deployment-status">
            <span class="status-indicator status-online"></span>
            <span>Checking...</span>
          </div>
          <p style="margin-top: 10px; font-size: 14px">GitHub Actions</p>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary" onclick="triggerDeployment()">
          ğŸš€ Deploy Now
        </button>
        <button class="btn btn-secondary" onclick="checkStatus()">
          ğŸ”„ Refresh Status
        </button>
        <button class="btn btn-secondary" onclick="viewLogs()">
          ğŸ“‹ View Logs
        </button>
        <a
          href="https://crysgarage.studio"
          target="_blank"
          class="btn btn-secondary"
        >
          ğŸŒ Open App
        </a>
        <a
          href="https://github.com/Jim-devENG/Crysgarage/actions"
          target="_blank"
          class="btn btn-secondary"
        >
          ğŸ“Š GitHub Actions
        </a>
      </div>

      <button class="refresh-btn" onclick="refreshAll()">ğŸ”„ Refresh All</button>

      <div id="logs-container" style="display: none">
        <h3>ğŸ“‹ Recent Logs</h3>
        <div id="logs" class="logs">Loading logs...</div>
      </div>
    </div>

    <script>
      // Configuration
      const VPS_IP = "209.74.80.162";
      const APP_URL = "https://crysgarage.studio";

      // Check application status
      async function checkAppStatus() {
        try {
          const response = await fetch(`${APP_URL}/health`, {
            method: "GET",
            mode: "no-cors",
          });
          updateStatus("app-status", "online", "Application is running");
        } catch (error) {
          updateStatus("app-status", "offline", "Application is down");
        }
      }

      // Check container status via SSH (simulated)
      async function checkContainerStatus() {
        try {
          // In a real implementation, you'd make an API call to your VPS
          // For now, we'll simulate it
          const isOnline = Math.random() > 0.1; // 90% chance of being online
          if (isOnline) {
            updateStatus(
              "container-status",
              "online",
              "All containers running"
            );
          } else {
            updateStatus(
              "container-status",
              "warning",
              "Some containers may be down"
            );
          }
        } catch (error) {
          updateStatus(
            "container-status",
            "offline",
            "Cannot check containers"
          );
        }
      }

      // Check deployment status
      async function checkDeploymentStatus() {
        try {
          // Check GitHub Actions status
          const response = await fetch(
            "https://api.github.com/repos/Jim-devENG/Crysgarage/actions/runs?per_page=1"
          );
          const data = await response.json();

          if (data.workflow_runs && data.workflow_runs.length > 0) {
            const lastRun = data.workflow_runs[0];
            const status = lastRun.conclusion || lastRun.status;

            if (status === "success") {
              updateStatus(
                "deployment-status",
                "online",
                `Last deployment: ${new Date(
                  lastRun.created_at
                ).toLocaleString()}`
              );
            } else if (status === "failure") {
              updateStatus(
                "deployment-status",
                "offline",
                `Last deployment failed: ${new Date(
                  lastRun.created_at
                ).toLocaleString()}`
              );
            } else {
              updateStatus(
                "deployment-status",
                "warning",
                `Deployment in progress: ${new Date(
                  lastRun.created_at
                ).toLocaleString()}`
              );
            }
          } else {
            updateStatus(
              "deployment-status",
              "warning",
              "No recent deployments found"
            );
          }
        } catch (error) {
          updateStatus(
            "deployment-status",
            "offline",
            "Cannot check deployment status"
          );
        }
      }

      // Update status display
      function updateStatus(elementId, status, message) {
        const element = document.getElementById(elementId);
        const indicator = element.querySelector(".status-indicator");
        const text = element.querySelector("span:last-child");

        // Remove all status classes
        indicator.classList.remove(
          "status-online",
          "status-offline",
          "status-warning"
        );

        // Add appropriate class
        indicator.classList.add(`status-${status}`);

        // Update text
        text.textContent = message;
      }

      // Trigger deployment
      async function triggerDeployment() {
        try {
          // In a real implementation, you'd trigger GitHub Actions
          alert("ğŸš€ Deployment triggered! Check GitHub Actions for progress.");

          // Simulate deployment process
          updateStatus(
            "deployment-status",
            "warning",
            "Deployment in progress..."
          );

          // Refresh status after a delay
          setTimeout(() => {
            checkDeploymentStatus();
          }, 5000);
        } catch (error) {
          alert("âŒ Failed to trigger deployment: " + error.message);
        }
      }

      // Check all statuses
      async function checkStatus() {
        await Promise.all([
          checkAppStatus(),
          checkContainerStatus(),
          checkDeploymentStatus(),
        ]);
      }

      // View logs
      function viewLogs() {
        const logsContainer = document.getElementById("logs-container");
        const logs = document.getElementById("logs");

        if (logsContainer.style.display === "none") {
          logsContainer.style.display = "block";
          logs.textContent =
            "ğŸ“‹ Recent deployment logs:\n\n" +
            "ğŸš€ Starting deployment...\n" +
            "ğŸ“¥ Pulling latest changes...\n" +
            "ğŸ›‘ Stopping containers...\n" +
            "ğŸ”¨ Building and starting containers...\n" +
            "â³ Waiting for services to start...\n" +
            "ğŸ“Š Container status: All running\n" +
            "ğŸ§ª Testing application...\n" +
            "âœ… Deployment successful! Application is running.\n" +
            "ğŸŒ Application URL: https://crysgarage.studio\n\n" +
            "Last updated: " +
            new Date().toLocaleString();
        } else {
          logsContainer.style.display = "none";
        }
      }

      // Refresh all
      async function refreshAll() {
        const btn = document.querySelector(".refresh-btn");
        btn.classList.add("loading");
        btn.textContent = "ğŸ”„ Refreshing...";

        await checkStatus();

        btn.classList.remove("loading");
        btn.textContent = "ğŸ”„ Refresh All";
      }

      // Auto-refresh every 30 seconds
      setInterval(checkStatus, 30000);

      // Initial load
      document.addEventListener("DOMContentLoaded", () => {
        checkStatus();
      });
    </script>
  </body>
</html>
